# Generated by Django 5.2.11 on 2026-02-27 13:54

import django.core.validators
import django.db.models.deletion
import django_fsm
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='ARCReader',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('email', models.EmailField(max_length=254, unique=True)),
                ('name', models.CharField(max_length=100)),
                ('genres_interested', models.JSONField(default=list, help_text="List of genres they're interested in")),
                ('reviews_left_count', models.PositiveIntegerField(default=0, help_text='Total reviews left across all ARC copies received')),
                ('arc_copies_received', models.PositiveIntegerField(default=0, help_text='Total ARC copies sent to this reader')),
                ('avg_rating_given', models.FloatField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(5)])),
                ('is_reliable', models.BooleanField(default=True, help_text="False if reader hasn't reviewed 3+ times after receiving ARCs")),
                ('unreliable_count', models.PositiveIntegerField(default=0, help_text="Number of times they received ARC but didn't review")),
                ('last_email_sent', models.DateTimeField(blank=True, null=True)),
                ('email_opt_out', models.BooleanField(default=False)),
                ('notes', models.TextField(blank=True)),
            ],
            options={
                'verbose_name': 'ARC Reader',
                'verbose_name_plural': 'ARC Readers',
                'ordering': ['-reviews_left_count'],
            },
        ),
        migrations.CreateModel(
            name='Book',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('title', models.CharField(help_text='Primary title (max 200 chars for KDP)', max_length=200)),
                ('subtitle', models.CharField(blank=True, help_text='Subtitle for SEO (max 200 chars for KDP)', max_length=200)),
                ('synopsis', models.TextField(blank=True, help_text='Internal synopsis/concept summary')),
                ('target_audience', models.CharField(blank=True, help_text='Target reader demographic', max_length=255)),
                ('comparable_titles', models.JSONField(blank=True, default=list, help_text='List of comparable book titles for positioning')),
                ('hook', models.TextField(blank=True, help_text='The core hook or concept that makes this book unique')),
                ('core_twist', models.TextField(blank=True, help_text='The main twist or revelation in the story')),
                ('lifecycle_status', django_fsm.FSMField(choices=[('concept_pending', 'Concept Pending'), ('keyword_research', 'Keyword Research'), ('keyword_approved', 'Keyword Approved'), ('description_generation', 'Description Generation'), ('description_approved', 'Description Approved'), ('bible_generation', 'Bible Generation'), ('bible_approved', 'Bible Approved'), ('writing_in_progress', 'Writing In Progress'), ('qa_review', 'QA Review'), ('export_ready', 'Export Ready'), ('published_kdp', 'Published on KDP'), ('published_all', 'Published on All Platforms'), ('archived', 'Archived')], db_index=True, default='concept_pending', help_text='Current stage in the book production pipeline', max_length=50)),
                ('asin', models.CharField(blank=True, db_index=True, help_text='Amazon Standard Identification Number', max_length=20)),
                ('bsr', models.PositiveIntegerField(blank=True, help_text='Best Seller Rank on Amazon', null=True)),
                ('published_at', models.DateTimeField(blank=True, help_text='Date when book was first published', null=True)),
                ('ai_detection_score', models.FloatField(blank=True, help_text='AI detection percentage from Originality.ai', null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('plagiarism_score', models.FloatField(blank=True, help_text='Plagiarism percentage from Copyscape', null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('total_revenue_usd', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('target_chapter_count', models.PositiveIntegerField(default=80, help_text='Target number of chapters (70-90 typical)', validators=[django.core.validators.MinValueValidator(10), django.core.validators.MaxValueValidator(200)])),
                ('target_word_count', models.PositiveIntegerField(default=80000, help_text='Target total word count')),
                ('current_word_count', models.PositiveIntegerField(default=0)),
                ('is_ai_generated_disclosure', models.BooleanField(default=True, help_text="If True, content is 'AI-Generated' (must disclose to KDP)")),
                ('kdp_preflight_passed', models.BooleanField(default=False)),
                ('copyright_registered', models.BooleanField(default=False)),
            ],
            options={
                'verbose_name': 'Book',
                'verbose_name_plural': 'Books',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='CompetitorBook',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('asin', models.CharField(db_index=True, max_length=20, unique=True)),
                ('title', models.CharField(max_length=300)),
                ('author', models.CharField(max_length=200)),
                ('genre', models.CharField(max_length=100)),
                ('subgenre', models.CharField(blank=True, max_length=100)),
                ('bsr', models.PositiveIntegerField(blank=True, help_text='Best Seller Rank', null=True)),
                ('review_count', models.PositiveIntegerField(default=0)),
                ('avg_rating', models.FloatField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(5)])),
                ('price_usd', models.DecimalField(blank=True, decimal_places=2, max_digits=6, null=True)),
                ('cover_style', models.CharField(blank=True, help_text="Cover style description (e.g., 'Dark with silhouette')", max_length=100)),
                ('description_hooks', models.JSONField(default=list, help_text='Effective hooks found in the description')),
                ('themes', models.JSONField(default=list, help_text='Main themes identified')),
                ('estimated_monthly_units', models.PositiveIntegerField(default=0, help_text='Estimated monthly unit sales based on BSR')),
                ('estimated_monthly_revenue', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('last_updated', models.DateTimeField(auto_now=True)),
                ('tracking_start_date', models.DateField(blank=True, null=True)),
                ('bsr_history', models.JSONField(default=list, help_text='[{"date": "2024-01-01", "bsr": 1234}, ...]')),
            ],
            options={
                'verbose_name': 'Competitor Book',
                'verbose_name_plural': 'Competitor Books',
                'ordering': ['bsr'],
            },
        ),
        migrations.CreateModel(
            name='PenName',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('name', models.CharField(help_text='The pen name/author name', max_length=100, unique=True)),
                ('niche_genre', models.CharField(help_text="Primary genre niche (e.g., 'Psychological Thriller', 'Cozy Mystery')", max_length=100)),
                ('bio', models.TextField(blank=True, help_text='Author biography for Amazon author page and marketing')),
                ('writing_style_prompt', models.TextField(blank=True, help_text="Default AI prompt defining this author's writing style")),
                ('profile_image', models.ImageField(blank=True, help_text='Author profile image', null=True, upload_to='pen_names/profiles/')),
                ('website_url', models.URLField(blank=True)),
                ('amazon_author_url', models.URLField(blank=True)),
                ('twitter_handle', models.CharField(blank=True, max_length=50)),
                ('email_list_signup_url', models.URLField(blank=True)),
                ('total_books_published', models.PositiveIntegerField(default=0)),
                ('total_revenue_usd', models.DecimalField(decimal_places=2, default=0, help_text='Total lifetime revenue from all books', max_digits=12)),
            ],
            options={
                'verbose_name': 'Pen Name',
                'verbose_name_plural': 'Pen Names',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='WebhookEvent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('stripe_event_id', models.CharField(db_index=True, max_length=100, unique=True)),
                ('event_type', models.CharField(max_length=100)),
                ('payload', models.JSONField(default=dict)),
                ('processed', models.BooleanField(default=False)),
                ('processing_error', models.TextField(blank=True)),
            ],
            options={
                'verbose_name': 'Webhook Event',
                'verbose_name_plural': 'Webhook Events',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='Chapter',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('chapter_number', models.PositiveIntegerField(validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(300)])),
                ('title', models.CharField(blank=True, help_text='Chapter title (optional)', max_length=200)),
                ('brief', models.JSONField(default=dict, help_text='\n        Chapter brief for AI writing:\n        {\n            "opening_hook": "...",\n            "key_events": ["...", "..."],\n            "ending_hook": "...",\n            "mood": "...",\n            "pov_character": "...",\n            "clues_to_plant": ["clue_001"],\n            "clues_to_reveal": [],\n            "characters_present": ["..."],\n            "location": "..."\n        }\n        ')),
                ('content', models.TextField(blank=True, help_text='Full chapter content')),
                ('word_count', models.PositiveIntegerField(default=0)),
                ('status', models.CharField(choices=[('pending', 'Pending Brief'), ('ready_to_write', 'Ready to Write'), ('writing', 'Writing in Progress'), ('written', 'Written'), ('pending_qa', 'Pending QA'), ('approved', 'Approved'), ('rejected', 'Rejected - Needs Rewrite'), ('published', 'Published')], db_index=True, default='pending', max_length=20)),
                ('ai_detection_score', models.FloatField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('plagiarism_score', models.FloatField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('qa_notes', models.TextField(blank=True, help_text='Notes from QA review (reasons for rejection, etc.)')),
                ('qa_reviewed_at', models.DateTimeField(blank=True, null=True)),
                ('generation_prompt', models.TextField(blank=True, help_text='The full prompt used to generate this chapter')),
                ('generation_model', models.CharField(blank=True, help_text="AI model used (e.g., 'gemini-1.5-pro')", max_length=50)),
                ('generation_tokens_used', models.PositiveIntegerField(default=0)),
                ('generation_cost_usd', models.DecimalField(decimal_places=4, default=0, max_digits=8)),
                ('generation_attempts', models.PositiveIntegerField(default=0)),
                ('published_at', models.DateTimeField(blank=True, null=True)),
                ('drip_scheduled_at', models.DateTimeField(blank=True, help_text='Scheduled date for drip-feed publishing on website', null=True)),
                ('book', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='chapters', to='novels.book')),
            ],
            options={
                'verbose_name': 'Chapter',
                'verbose_name_plural': 'Chapters',
                'ordering': ['book', 'chapter_number'],
            },
        ),
        migrations.CreateModel(
            name='ChapterPurchase',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('price_usd', models.DecimalField(decimal_places=2, max_digits=5, validators=[django.core.validators.MinValueValidator(0)])),
                ('stripe_payment_intent_id', models.CharField(blank=True, db_index=True, max_length=100)),
                ('is_refunded', models.BooleanField(default=False)),
                ('refunded_at', models.DateTimeField(blank=True, null=True)),
                ('chapter', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='purchases', to='novels.chapter')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='chapter_purchases', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Chapter Purchase',
                'verbose_name_plural': 'Chapter Purchases',
            },
        ),
        migrations.CreateModel(
            name='DistributionChannel',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('platform', models.CharField(choices=[('kdp', 'Amazon KDP'), ('draft2digital', 'Draft2Digital'), ('acx', 'ACX (Audiobook)'), ('publishdrive', 'PublishDrive'), ('website', 'Own Website'), ('patreon', 'Patreon'), ('apple_books', 'Apple Books'), ('kobo', 'Kobo'), ('barnes_noble', 'Barnes & Noble')], max_length=20)),
                ('asin_or_id', models.CharField(blank=True, help_text='ASIN, ISBN, or platform-specific ID', max_length=50)),
                ('published_url', models.URLField(blank=True, help_text='Direct URL to the book on this platform')),
                ('units_sold', models.PositiveIntegerField(default=0)),
                ('pages_read', models.PositiveIntegerField(default=0, help_text='For KU/page-read platforms')),
                ('revenue_usd', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('royalty_rate', models.FloatField(default=0.7, help_text='Royalty rate (0.35, 0.70, etc.)', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('is_active', models.BooleanField(default=True)),
                ('published_at', models.DateTimeField(blank=True, null=True)),
                ('unpublished_at', models.DateTimeField(blank=True, null=True)),
                ('last_synced_at', models.DateTimeField(blank=True, null=True)),
                ('sync_error', models.TextField(blank=True)),
                ('book', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='distribution_channels', to='novels.book')),
            ],
            options={
                'verbose_name': 'Distribution Channel',
                'verbose_name_plural': 'Distribution Channels',
                'ordering': ['platform'],
            },
        ),
        migrations.CreateModel(
            name='KeywordResearch',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('primary_keywords', models.JSONField(default=list, help_text='\n        Primary keywords with search volume:\n        [\n            {"keyword": "psychological thriller", "volume": 12000, "competition": "medium"},\n            ...\n        ]\n        ')),
                ('kdp_backend_keywords', models.JSONField(default=list, help_text='\n        7 backend keywords for KDP (not visible to customers):\n        ["keyword1", "keyword2", ..., "keyword7"]\n        ')),
                ('kdp_category_1', models.CharField(blank=True, help_text="Primary BISAC category path (e.g., 'Fiction > Thrillers > Psychological')", max_length=255)),
                ('kdp_category_2', models.CharField(blank=True, help_text='Secondary BISAC category path', max_length=255)),
                ('suggested_title', models.CharField(blank=True, help_text='AI-suggested title with keywords in first 5 words', max_length=200, validators=[django.core.validators.MaxLengthValidator(200)])),
                ('suggested_subtitle', models.CharField(blank=True, help_text='AI-suggested subtitle with secondary keywords', max_length=200, validators=[django.core.validators.MaxLengthValidator(200)])),
                ('competitor_asins', models.JSONField(default=list, help_text='\n        Top competitor ASINs with data:\n        [\n            {\n                "asin": "B0...",\n                "title": "...",\n                "bsr": 1234,\n                "reviews": 500,\n                "rating": 4.2,\n                "price": 2.99\n            }\n        ]\n        ')),
                ('avg_competitor_reviews', models.PositiveIntegerField(default=0, help_text='Average review count of top 5 competitors')),
                ('avg_competitor_bsr', models.PositiveIntegerField(default=0, help_text='Average BSR of top 5 competitors')),
                ('keyword_search_volume', models.JSONField(default=dict, help_text='\n        Monthly search volume data:\n        {\n            "primary_keyword": 12000,\n            "long_tail_1": 500,\n            ...\n        }\n        ')),
                ('is_approved', models.BooleanField(default=False)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('data_source', models.CharField(default='dataforseo', help_text='API source (dataforseo, scraperapi, manual)', max_length=50)),
                ('last_research_at', models.DateTimeField(blank=True, null=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_keyword_research', to=settings.AUTH_USER_MODEL)),
                ('book', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='keyword_research', to='novels.book')),
            ],
            options={
                'verbose_name': 'Keyword Research',
                'verbose_name_plural': 'Keyword Research',
            },
        ),
        migrations.AddField(
            model_name='book',
            name='pen_name',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='books', to='novels.penname'),
        ),
        migrations.CreateModel(
            name='PricingStrategy',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('current_phase', models.CharField(choices=[('launch', 'Launch Phase ($0.99)'), ('growth', 'Growth Phase ($2.99)'), ('mature', 'Mature Phase ($3.99+)'), ('promo', 'Promotional ($0.99)'), ('bundle', 'Bundle/Box Set')], default='launch', max_length=20)),
                ('current_price_usd', models.DecimalField(decimal_places=2, default=0.99, max_digits=5, validators=[django.core.validators.MinValueValidator(0.0), django.core.validators.MaxValueValidator(999.99)])),
                ('reviews_threshold_for_growth', models.PositiveIntegerField(default=20, help_text='Reviews needed to transition from Launch to Growth')),
                ('days_in_launch_phase', models.PositiveIntegerField(default=7, help_text='Days to stay in Launch phase regardless of reviews')),
                ('is_kdp_select', models.BooleanField(default=True, help_text='Enrolled in KDP Select (required for Kindle Countdown)')),
                ('kdp_select_enrollment_date', models.DateField(blank=True, null=True)),
                ('next_promotion_date', models.DateField(blank=True, null=True)),
                ('next_promotion_type', models.CharField(blank=True, choices=[('kindle_countdown', 'Kindle Countdown Deal'), ('free_promo', 'Free Promotion (KDP Select)'), ('price_drop', 'Temporary Price Drop')], max_length=20)),
                ('last_promotion_date', models.DateField(blank=True, null=True)),
                ('days_between_promotions', models.PositiveIntegerField(default=90, help_text='Minimum days between Kindle Countdown deals')),
                ('auto_price_enabled', models.BooleanField(default=True, help_text='Enable automatic price transitions')),
                ('price_history', models.JSONField(default=list, help_text='\n        Price change history:\n        [\n            {"date": "2024-01-01", "price": 0.99, "phase": "launch", "reason": "Initial launch"},\n            ...\n        ]\n        ')),
                ('book', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='pricing_strategy', to='novels.book')),
            ],
            options={
                'verbose_name': 'Pricing Strategy',
                'verbose_name_plural': 'Pricing Strategies',
            },
        ),
        migrations.CreateModel(
            name='ReviewTracker',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('total_reviews', models.PositiveIntegerField(default=0)),
                ('avg_rating', models.FloatField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(5)])),
                ('reviews_week_1', models.PositiveIntegerField(default=0)),
                ('reviews_week_2', models.PositiveIntegerField(default=0)),
                ('reviews_week_3', models.PositiveIntegerField(default=0)),
                ('reviews_week_4', models.PositiveIntegerField(default=0)),
                ('positive_themes', models.JSONField(default=list, help_text='Common positive themes from reviews')),
                ('negative_themes', models.JSONField(default=list, help_text='Common negative themes/complaints from reviews')),
                ('arc_emails_sent', models.PositiveIntegerField(default=0)),
                ('arc_reviews_received', models.PositiveIntegerField(default=0)),
                ('arc_conversion_rate', models.FloatField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('rating_distribution', models.JSONField(default=dict, help_text='{"5": 100, "4": 50, "3": 10, "2": 5, "1": 2}')),
                ('last_scraped', models.DateTimeField(blank=True, null=True)),
                ('scrape_error', models.TextField(blank=True)),
                ('book', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='review_tracker', to='novels.book')),
            ],
            options={
                'verbose_name': 'Review Tracker',
                'verbose_name_plural': 'Review Trackers',
            },
        ),
        migrations.CreateModel(
            name='StoryBible',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('characters', models.JSONField(default=dict, help_text='\n        Character definitions in format:\n        {\n            "protagonist": {\n                "name": "...",\n                "age": ...,\n                "occupation": "...",\n                "personality": "...",\n                "wound": "...",\n                "goal": "...",\n                "arc": "..."\n            },\n            "antagonist": {...},\n            "supporting": [{...}, {...}]\n        }\n        ')),
                ('world_rules', models.JSONField(default=dict, help_text='\n        World/setting rules:\n        {\n            "setting": "...",\n            "time_period": "...",\n            "locations": [{...}],\n            "important_rules": ["..."],\n            "technology_level": "...",\n            "social_structures": "..."\n        }\n        ')),
                ('timeline', models.JSONField(default=list, help_text='\n        Story timeline events:\n        [\n            {"day": 1, "event": "...", "chapter_range": [1, 5]},\n            ...\n        ]\n        ')),
                ('four_act_outline', models.JSONField(default=dict, help_text='\n        Four-act structure:\n        {\n            "act_1_setup": {\n                "chapters": [1, 20],\n                "summary": "...",\n                "key_events": ["..."]\n            },\n            "act_2_confrontation": {...},\n            "act_3_complication": {...},\n            "act_4_resolution": {...}\n        }\n        ')),
                ('clues_tracker', models.JSONField(default=list, help_text='\n        Clue tracking for mysteries:\n        [\n            {\n                "clue_id": "clue_001",\n                "description": "...",\n                "planted_in_chapter": 5,\n                "revealed_in_chapter": 45,\n                "is_red_herring": false,\n                "connected_to": ["clue_002"]\n            }\n        ]\n        ')),
                ('themes', models.JSONField(default=list, help_text='List of primary themes to weave throughout the story')),
                ('tone', models.CharField(blank=True, help_text="Overall tone (e.g., 'Dark and suspenseful', 'Light-hearted mystery')", max_length=100)),
                ('pov', models.CharField(default='Third Person Limited', help_text='Point of View (First Person, Third Person Limited, etc.)', max_length=50)),
                ('tense', models.CharField(default='Past', help_text='Narrative tense (Past, Present)', max_length=20)),
                ('summary_for_ai', models.TextField(blank=True, help_text='500-word summary optimized for AI prompt injection')),
                ('book', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='story_bible', to='novels.book')),
            ],
            options={
                'verbose_name': 'Story Bible',
                'verbose_name_plural': 'Story Bibles',
            },
        ),
        migrations.CreateModel(
            name='StyleFingerprint',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('avg_sentence_length', models.FloatField(default=15, help_text='Average words per sentence')),
                ('avg_paragraph_length', models.FloatField(default=4, help_text='Average sentences per paragraph')),
                ('avg_chapter_length', models.PositiveIntegerField(default=1000, help_text='Average words per chapter')),
                ('dialogue_ratio', models.FloatField(default=0.3, help_text='Percentage of content that is dialogue', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('adverb_frequency', models.FloatField(default=0.02, help_text='Adverb usage rate', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('passive_voice_ratio', models.FloatField(default=0.1, help_text='Percentage of passive voice sentences', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('common_word_patterns', models.JSONField(default=dict, help_text='\n        Frequently used phrases and patterns:\n        {\n            "sentence_starters": ["He knew", "She wondered", ...],\n            "transitions": ["Meanwhile", "However", ...],\n            "descriptive_patterns": ["the way he", "as if", ...]\n        }\n        ')),
                ('forbidden_words', models.JSONField(default=list, help_text='Words to avoid (clichés, overused terms)')),
                ('style_system_prompt', models.TextField(blank=True, help_text='Auto-generated system prompt for AI to match this style')),
                ('chapters_analyzed', models.PositiveIntegerField(default=0)),
                ('last_recalculated', models.DateTimeField(blank=True, null=True)),
                ('needs_recalculation', models.BooleanField(default=False)),
                ('pen_name', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='style_fingerprint', to='novels.penname')),
            ],
            options={
                'verbose_name': 'Style Fingerprint',
                'verbose_name_plural': 'Style Fingerprints',
            },
        ),
        migrations.CreateModel(
            name='Subscription',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('plan', models.CharField(choices=[('free', 'Free (Limited Access)'), ('chapter', 'Pay Per Chapter'), ('monthly', 'Monthly Subscription ($9.99/mo)'), ('annual', 'Annual Subscription ($99.99/yr)')], default='free', max_length=20)),
                ('status', models.CharField(choices=[('active', 'Active'), ('canceled', 'Canceled'), ('past_due', 'Past Due'), ('expired', 'Expired'), ('trialing', 'Trial')], default='active', max_length=20)),
                ('stripe_customer_id', models.CharField(blank=True, db_index=True, max_length=100)),
                ('stripe_subscription_id', models.CharField(blank=True, db_index=True, max_length=100)),
                ('current_period_start', models.DateTimeField(blank=True, null=True)),
                ('current_period_end', models.DateTimeField(blank=True, null=True)),
                ('cancel_at_period_end', models.BooleanField(default=False)),
                ('trial_start', models.DateTimeField(blank=True, null=True)),
                ('trial_end', models.DateTimeField(blank=True, null=True)),
                ('total_spent_usd', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='subscription', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Subscription',
                'verbose_name_plural': 'Subscriptions',
            },
        ),
        migrations.CreateModel(
            name='AdsPerformance',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('report_date', models.DateField(db_index=True)),
                ('impressions', models.PositiveIntegerField(default=0)),
                ('clicks', models.PositiveIntegerField(default=0)),
                ('spend_usd', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('sales_usd', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('acos', models.FloatField(blank=True, help_text='ACOS = (Spend / Sales) × 100', null=True, validators=[django.core.validators.MinValueValidator(0)])),
                ('ctr', models.FloatField(blank=True, help_text='Click-through rate percentage', null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('cpc', models.DecimalField(blank=True, decimal_places=2, help_text='Cost per click', max_digits=6, null=True)),
                ('top_keywords', models.JSONField(default=list, help_text='\n        Top performing keywords:\n        [{"keyword": "...", "impressions": 100, "clicks": 10, "sales": 5.99}]\n        ')),
                ('keywords_to_pause', models.JSONField(default=list, help_text='Keywords recommended for pausing (ACOS > 70%)')),
                ('keywords_to_scale', models.JSONField(default=list, help_text='Keywords recommended for bid increase (ACOS < 25%)')),
                ('orders', models.PositiveIntegerField(default=0)),
                ('units_sold', models.PositiveIntegerField(default=0)),
                ('book', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='ads_performance', to='novels.book')),
            ],
            options={
                'verbose_name': 'Ads Performance',
                'verbose_name_plural': 'Ads Performance',
                'ordering': ['-report_date'],
                'unique_together': {('book', 'report_date')},
            },
        ),
        migrations.CreateModel(
            name='BookDescription',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('version', models.CharField(choices=[('A', 'Version A'), ('B', 'Version B')], default='A', max_length=1)),
                ('description_html', models.TextField(help_text='HTML description (only <b>, <em>, <br>, <ul>, <li> allowed)')),
                ('description_plain', models.TextField(blank=True, help_text='Plain text version (auto-generated from HTML)')),
                ('hook_line', models.TextField(blank=True, help_text='Opening hook - question or exciting statement')),
                ('setup_paragraph', models.TextField(blank=True, help_text='Setup - who is the protagonist, what do they face')),
                ('stakes_paragraph', models.TextField(blank=True, help_text='Stakes - what happens if they fail')),
                ('twist_tease', models.TextField(blank=True, help_text="Twist tease - 'But nothing is what it seems...'")),
                ('call_to_action', models.TextField(blank=True, help_text="CTA - 'Perfect for fans of X and Y. Grab your copy today.'")),
                ('comparable_authors', models.JSONField(default=list, help_text="List of comparable authors for 'Perfect for fans of...' CTA")),
                ('is_active', models.BooleanField(default=False, help_text='Is this the active description for the book')),
                ('is_approved', models.BooleanField(default=False)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('character_count', models.PositiveIntegerField(default=0, help_text='Total character count (Amazon max: 4000)')),
                ('book', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='descriptions', to='novels.book')),
            ],
            options={
                'verbose_name': 'Book Description',
                'verbose_name_plural': 'Book Descriptions',
                'unique_together': {('book', 'version')},
            },
        ),
        migrations.AddIndex(
            model_name='chapter',
            index=models.Index(fields=['book', 'status'], name='novels_chap_book_id_a5fb19_idx'),
        ),
        migrations.AddIndex(
            model_name='chapter',
            index=models.Index(fields=['status', 'is_deleted'], name='novels_chap_status_6087d4_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='chapter',
            unique_together={('book', 'chapter_number')},
        ),
        migrations.AlterUniqueTogether(
            name='chapterpurchase',
            unique_together={('user', 'chapter')},
        ),
        migrations.AlterUniqueTogether(
            name='distributionchannel',
            unique_together={('book', 'platform')},
        ),
        migrations.AddIndex(
            model_name='book',
            index=models.Index(fields=['lifecycle_status', 'is_deleted'], name='novels_book_lifecyc_f2a9f8_idx'),
        ),
        migrations.AddIndex(
            model_name='book',
            index=models.Index(fields=['pen_name', 'lifecycle_status'], name='novels_book_pen_nam_6304c5_idx'),
        ),
    ]
