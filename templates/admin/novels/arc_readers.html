{% extends "admin/base_site.html" %}

{% block title %}ARC Reader Database{% endblock %}

{% block content %}
<div style="max-width:1100px">
  <h1>ğŸ‘¥ ARC Reader Database</h1>

  {% if messages %}
    {% for msg in messages %}
      <div class="messagelist"><p class="{{ msg.tags }}">{{ msg }}</p></div>
    {% endfor %}
  {% endif %}

  <div style="display:flex;gap:1rem;margin-bottom:1rem;align-items:center">
    <div style="background:#007bff;color:#fff;padding:0.75rem 1.25rem;border-radius:6px;text-align:center">
      <strong style="font-size:1.5rem">{{ total }}</strong><br><small>Total Readers</small>
    </div>
    <div style="background:#28a745;color:#fff;padding:0.75rem 1.25rem;border-radius:6px;text-align:center">
      <strong style="font-size:1.5rem">{{ reliable }}</strong><br><small>Reliable</small>
    </div>
    <div style="background:#dc3545;color:#fff;padding:0.75rem 1.25rem;border-radius:6px;text-align:center">
      <strong style="font-size:1.5rem">{{ unreliable }}</strong><br><small>Unreliable</small>
    </div>
    <div style="margin-left:auto">
      <a href="{% url 'arc_reader_import' %}" class="button default">ğŸ“¤ Import CSV</a>
    </div>
  </div>

  <!-- Filters -->
  <form method="get" style="display:flex;gap:0.5rem;margin-bottom:1rem">
    <input type="text" name="genre" value="{{ genre_filter }}" placeholder="Filter by genre..." style="padding:0.4rem 0.75rem;border:1px solid #ddd;border-radius:4px">
    <select name="reliable" style="padding:0.4rem;border:1px solid #ddd;border-radius:4px">
      <option value="">All</option>
      <option value="1" {% if reliable_filter == '1' %}selected{% endif %}>Reliable only</option>
      <option value="0" {% if reliable_filter == '0' %}selected{% endif %}>Unreliable only</option>
    </select>
    <button type="submit" class="button">ğŸ” Filter</button>
    <a href="{% url 'arc_reader_list' %}" class="button">Clear</a>
  </form>

  <table style="width:100%;border-collapse:collapse;background:#fff;border-radius:6px;overflow:hidden;box-shadow:0 1px 4px rgba(0,0,0,0.08)">
    <thead style="background:#f8f8f8">
      <tr>
        <th style="padding:10px;text-align:left">Name</th>
        <th style="padding:10px;text-align:left">Email</th>
        <th style="padding:10px;text-align:left">Genres</th>
        <th style="padding:10px;text-align:center">Reviews Left</th>
        <th style="padding:10px;text-align:center">Avg Rating</th>
        <th style="padding:10px;text-align:center">Reliable</th>
        <th style="padding:10px;text-align:center">Last Email</th>
      </tr>
    </thead>
    <tbody>
    {% for reader in readers %}
      <tr style="border-top:1px solid #eee;{% if not reader.is_reliable %}background:#fff8f8{% endif %}">
        <td style="padding:10px"><strong>{{ reader.name }}</strong></td>
        <td style="padding:10px;font-size:0.85rem">{{ reader.email }}</td>
        <td style="padding:10px;font-size:0.85rem">
          {% for g in reader.genres_interested %}<span style="background:#e8f4fd;border-radius:4px;padding:2px 6px;margin-right:3px;font-size:0.75rem">{{ g }}</span>{% endfor %}
        </td>
        <td style="padding:10px;text-align:center">{{ reader.reviews_left_count }}</td>
        <td style="padding:10px;text-align:center">{{ reader.avg_rating_given }}â˜…</td>
        <td style="padding:10px;text-align:center">
          {% if reader.is_reliable %}<span style="color:#28a745">âœ“ Yes</span>{% else %}<span style="color:#dc3545">âœ— No</span>{% endif %}
        </td>
        <td style="padding:10px;text-align:center;font-size:0.8rem">{{ reader.last_email_sent|default:"Never" }}</td>
      </tr>
    {% empty %}
      <tr><td colspan="7" style="padding:2rem;text-align:center;color:#999">No readers found. <a href="{% url 'arc_reader_import' %}">Import from CSV</a></td></tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
